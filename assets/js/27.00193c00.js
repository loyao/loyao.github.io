(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{425:function(s,a,n){"use strict";n.r(a);var t=n(2),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"集群部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集群部署"}},[s._v("#")]),s._v(" 集群部署")]),s._v(" "),a("p",[s._v("首先在执行安装的主机上安装ansible，并且在/etc/ansible/host中添加如下的节点配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("dbnode "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.110  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\nnode1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.113  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("保证在执行安装配置的时候ansible能连接到对应节点。需要改对应主机的名字 /etc/host 改为节点对应的名字")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/ansible/ansible.cfg\n在文件中进行搜索定位到\n:/host_key_checking\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("# uncomment this to disable SSH key "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" checking\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#host_key_checking = False //取消注释")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ansible tower 3.75需要的数据库是postgresql10，安装程序会自己在对应的数据库机器中去执行")]),s._v(" "),a("p",[s._v("编辑安装程序下的inventory，配置如下")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("tower"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nlocalhost "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_connection")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("local\nansiblenode1 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.113  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("database"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndbnode  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.110  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_user")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_pass")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("all:vars"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("admin_password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pg_host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.18.0.110'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pg_port")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'5432'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pg_database")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'awx'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pg_username")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'awx'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pg_password")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'awx'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pg_sslmode")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'prefer'")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# set to 'verify-full' for client-side enforced SSL")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("​      这里需要注意的是节点后配置登录信息是因为执行安装的时候会有调试联通对应主机，所以为了防止报错，至于数据库设置不是设置成为主机名字是因为，只有名字的主机安装程序会")]),s._v(" "),a("p",[s._v("若果安装失败，但是系统依赖已经安装之后，需要手动卸载掉依赖，并清除对应文件，否则的话安装程序会同步机器上的配置文件就会报错。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("ansible-tower-service stop\nyum remove ansible-tower"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("*\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /var/lib/awx/venv/awx\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /var/lib/awx/venv/ansible\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("根本原因")]),s._v(" "),a("p",[s._v("将 Ansible Tower 安装/升级到 ，awx是awxvirtualenv（即/var/lib/awx/venv/awx）中必需的库。如果未正确安装 Python3，则将awx找不到该发行版。")]),s._v(" "),a("p",[s._v("破解,集群方式的话，需要每个节点都破解")]),s._v(" "),a("p",[s._v("安装python反编译工具")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" python3-pip\npip3 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" uncompyle6\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/lib/awx/venv/awx/lib/python3.6/site-packages/tower_license\n\n反编译\nuncompyle6 __init__.pyc "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("__init__.py\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" __init__.py\n\n找到def _generate_cloudforms_subscription"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":函数\n修改license_date变量的值为253370764800\n找到下个def _check_cloudforms_subscription"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":函数\n添加return true代码\n\n重新编译\npython3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" py_compile __init__.py\npython3 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-O")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-m")]),s._v(" py_compile __init__.py\n\n重启服务\nansible-tower-service restart \n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h1",{attrs:{id:"离线安装的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#离线安装的问题"}},[s._v("#")]),s._v(" 离线安装的问题")]),s._v(" "),a("p",[s._v("​     首先是需要注意的的是，在安装的机器上他会检查有没有rh版本的postgresql，对此需要注意的就是，集群状态下的数据库可能不在本机，但是最好是先安装，以便通过安装程序的检查。")]),s._v(" "),a("p",[s._v("关于rh-postgresql的配置：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装的软件")]),s._v("\nrh-postgresql10-postgresql-server \nrh-postgresql10-postgresql-devel\nrh-postgresql10-postgresql\nrh-postgresql10-postgresql-libs      \nrh-postgresql10-runtime\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#安装完成后的操作")]),s._v("\nscl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rh-postgresql10 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" /opt/rh/rh-postgresql10/enable\npostgresql-setup initdb "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#初始化数据库")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /var/opt/rh/rh-postgresql10/lib/pgsql/data\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" pg_hba.conf\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#添加允许远程连接，可以设置为指定ip或者网段")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("    all             all             "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0/0               trust\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" postgresql.conf\nlisten_addresses "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#设置监听地址")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);